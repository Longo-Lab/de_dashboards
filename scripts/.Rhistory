library(tidyverse)
library(data.table)
lab_dir <- file.path('/Volumes/lab_flongo')
proj_dir <- file.path(lab_dir, 'PS19_C31_stim')
dashboard_dir <- file.path(proj_dir, 'Gene_level', 'dashboard')
nameset <- 'PS19_C31_stim'
output_dir <- file.path('.', 'outputs', nameset)  # relative to Rmd
output_dir <- file.path(lab_dir, 'ps19_c31' 'output', nameset)  # relative to Rmd
output_dir <- file.path(lab_dir, 'ps19_c31', 'output', nameset)  # relative to Rmd
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("biomaRt")
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
ensembl_genes <- get_genes_info(ensembl_ver = '105')
# Generate results
rmarkdown::render(
input = 'dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
# Generate results
rmarkdown::render(
input = file.path(alab_dir, 'dashboard.Rmd')
output_file = file.path(output_dir, str_c(nameset, '.html')),
# Generate results
rmarkdown::render(
input = file.path(alab_dir, 'dashboard.Rmd')
output_file = file.path(output_dir, str_c(nameset, '.html')),
# Generate results
rmarkdown::render(
input = file.path(alab_dir, 'dashboard.Rmd')
output_file = file.path(output_dir, str_c(nameset, '.html')),
# Generate results
rmarkdown::render(
input = file.path(alab_dir, 'dashboard.Rmd')
output_file = file.path(output_dir, str_c(nameset, '.html')),
# Generate results
rmarkdown::render(
input = file.path(alab_dir, 'de_dashboard', 'dashboard.Rmd')
output_file = file.path(output_dir, str_c(nameset, '.html')),
# Generate results
rmarkdown::render(
input = file.path(alab_dir, 'de_dashboard', 'dashboard.Rmd'),
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
# Generate results
rmarkdown::render(
input = 'dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
# Generate results
rmarkdown::render(
input = 'de_dashboard/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
# Generate results
rmarkdown::render(
input = 'de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
# Generate results
rmarkdown::render(
input = 'Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
library(tidyverse)
lab_dir <- file.path('', 'oak', 'stanford', 'scg', 'lab_flongo')
library(tidyverse)
library(data.table)
lab_dir <- file.path('', 'oak', 'stanford', 'scg', 'lab_flongo')
lab_dir <- file.path('/Volumes/labs_flongo', 'lab_flongo')
proj_dir <- file.path(lab_dir, 'Tau-PS19_C31_cortex_snRNAseq')
seurat_dir <- file.path(proj_dir, 'seurat_v3')
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
install.packages(flexdashboard)
nameset <- 'PS19_C31'
output_dir <- file.path('.', 'outputs', nameset)  # relative to Rmd
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
lab_dir <- file.path('/Volumes/lab_flongo', 'lab_flongo')
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
lab_dir <- file.path('/Volumes', 'lab_flongo')
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
ensembl_genes <- get_genes_info(ensembl_ver = '105')
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
install.packages("flexdashboard", type="source")
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
ensembl_genes <- get_genes_info(ensembl_ver = '105')
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
ensembl_genes <- get_genes_info(ensembl_ver = '105')
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
View(get_genes_info)
library(data.table)
library(stringr)
library(biomaRt)
get_genes_info <- function(ensembl_set = 'mmusculus_gene_ensembl', ensembl_ver) {
# Fetch Ensembl genes
ensembl <- useEnsembl('ensembl', dataset = ensembl_set, version = ensembl_ver)
ensembl_genes <- data.table(getBM(
attributes = c('ensembl_gene_id', 'external_gene_name', 'gene_biotype', 'chromosome_name'),
filters = 'chromosome_name',
values = c(1:19, 'X', 'Y', 'MT'),
mart = ensembl
))
keep_categ <- grep('pseudo', unique(ensembl_genes$gene_biotype), value = T, invert = T)
keep_categ <- grep('TEC', keep_categ, value = T, invert = T)
ensembl_genes <- ensembl_genes[gene_biotype %in% keep_categ]
# Read in modules
lab_dir <- file.path('', 'oak', 'stanford', 'scg', 'lab_flongo')
ref_dir <- file.path(lab_dir, 'reference', 'biodomains')
modules <- c('TREAT-AD.Mouse.Genes.txt', 'TMT-LP.Mouse.Genes.txt', 'Mostafavi_etal.Mouse.Genes.txt', 'Milind_etal.Mouse.Genes.txt', 'AD_modules_full.tsv')
names(modules) <- c('treatAD', 'tmtAD', 'mostafavi', 'milind', 'wan')
for (m in names(modules)) {
module <- fread(file.path(ref_dir, modules[[m]]))
setnames(module, c('Mmus_GeneID', 'Module'), c('GENE', 'module'), skip_absent = T)
# Collapse by GENE (Ensembl ID)
module <- module[, setNames(.(str_flatten(unique(module), ',')), m), by = GENE]
# Merge modules
ensembl_genes <- merge(ensembl_genes, module, by.x = 'ensembl_gene_id', by.y = 'GENE', all.x = T)
}
ensembl_genes
}
# Get Ensembl genes info
source(file.path(lab_dir, 'de_dashboards', 'scripts', 'genes_info.R'))
ensembl_genes <- get_genes_info(ensembl_ver = '105')
ensembl_genes <- get_genes_info(ensembl_ver = '105')
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
View(get_genes_info)
ensembl_genes <- data.table(getBM(
attributes = c('ensembl_gene_id', 'external_gene_name', 'gene_biotype', 'chromosome_name'),
filters = 'chromosome_name',
values = c(1:19, 'X', 'Y', 'MT'),
mart = ensembl
))
keep_categ <- grep('pseudo', unique(ensembl_genes$gene_biotype), value = T, invert = T)
library(data.table)
library(stringr)
library(biomaRt)
get_genes_info <- function(ensembl_set = 'mmusculus_gene_ensembl', ensembl_ver) {
# Fetch Ensembl genes
ensembl <- useEnsembl('ensembl', dataset = ensembl_set, version = ensembl_ver)
ensembl_genes <- data.table(getBM(
attributes = c('ensembl_gene_id', 'external_gene_name', 'gene_biotype', 'chromosome_name'),
filters = 'chromosome_name',
values = c(1:19, 'X', 'Y', 'MT'),
mart = ensembl
))
keep_categ <- grep('pseudo', unique(ensembl_genes$gene_biotype), value = T, invert = T)
keep_categ <- grep('TEC', keep_categ, value = T, invert = T)
ensembl_genes <- ensembl_genes[gene_biotype %in% keep_categ]
# Read in modules
lab_dir <- file.path('', 'oak', 'stanford', 'scg', 'lab_flongo')
ref_dir <- file.path(lab_dir, 'reference', 'biodomains')
modules <- c('TREAT-AD.Mouse.Genes.txt', 'TMT-LP.Mouse.Genes.txt', 'Mostafavi_etal.Mouse.Genes.txt', 'Milind_etal.Mouse.Genes.txt', 'AD_modules_full.tsv')
names(modules) <- c('treatAD', 'tmtAD', 'mostafavi', 'milind', 'wan')
for (m in names(modules)) {
module <- fread(file.path(ref_dir, modules[[m]]))
setnames(module, c('Mmus_GeneID', 'Module'), c('GENE', 'module'), skip_absent = T)
# Collapse by GENE (Ensembl ID)
module <- module[, setNames(.(str_flatten(unique(module), ',')), m), by = GENE]
# Merge modules
ensembl_genes <- merge(ensembl_genes, module, by.x = 'ensembl_gene_id', by.y = 'GENE', all.x = T)
}
ensembl_genes
}
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
ensembl_genes <- get_genes_info(ensembl_ver = '105')
# Generate results
rmarkdown::render(
input = '/Volumes/lab_flongo/de_dashboards/dashboard.Rmd',
output_file = file.path(output_dir, str_c(nameset, '.html')),
params = list(
base_dir = dashboard_dir,
ensembl_genes = ensembl_genes,
nameset = nameset,
geno = 'PS19',
drug = 'C31',
filedate = '20220923',
de_cols = c('Gene_id', 'log2FoldChange', 'padj', 'pvalue'),
de_names = c('Log2FC', 'Pval (adj)', 'Pval'),
pval_col = 'pvalue',
lfc_unshrunken_col = 'log2FoldChange',
fdr_cutoff = 0.05,
lfc_cutoff_geno = 3.5,
lfc_cutoff_drug = 3.5
)
)
